<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>11402 çµ±è¨ˆå­¸(äºŒ)å­¸æœŸæˆç¸¾æŸ¥è©¢ - ç‹å»ºæ™º æ•™æˆ</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; }
        
        /* é–ƒçˆå‹•ç•« (ä¿ç•™æ‚¨ä¸Šæ¬¡è¦æ±‚çš„è¨­å®š) */
        @keyframes blink-pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(0.92); }
        }
        .animate-blink {
            animation: blink-pulse 1.2s ease-in-out infinite;
        }
    </style>
</head>
<body class="bg-slate-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;

        // âš ï¸ã€é‡è¦ã€‘è«‹å°‡ä¸‹æ–¹ç¶²å€æ›å›æ‚¨è‡ªå·±çš„ Google Apps Script ç¶²å€
        const API_URL = "https://script.google.com/macros/s/AKfycbzRR89dInIarHVk7pNsFnzZxvV1D7jdwhUmkwjBxOL3FhcyMUI2CRfUATkp1NK0cxWV3A/exec"; 

        const App = () => {
            const [query, setQuery] = useState('');
            const [searchResult, setSearchResult] = useState(null);
            const [loading, setLoading] = useState(false);
            const [stats, setStats] = useState({ green: 0, yellow: 0, red: 0, total: 0 });

            // --- ä¿®æ”¹è™•ï¼šæ‹†åˆ†ä¸»æ¨™é¡Œèˆ‡æ‹¬è™Ÿå…§çš„å‰¯æ¨™é¡Œ ---
            const getStatus = (score) => {
                const roundedScore = Math.round(score);
                
                if (roundedScore < 50) return { 
                    color: 'red', 
                    label: 'ç´…ç‡ˆ', 
                    desc: 'æˆç¸¾æœªé”æ¨™', 
                    sub: '', // ç´…ç‡ˆç„¡å‰¯æ¨™é¡Œ
                    bg: 'bg-red-500' 
                };
                if (roundedScore >= 65) return { 
                    color: 'green', 
                    label: 'ç¶ ç‡ˆ', 
                    desc: 'æ­å–œé€šé', 
                    sub: '', // ç¶ ç‡ˆç„¡å‰¯æ¨™é¡Œ
                    bg: 'bg-green-500' 
                };
                return { 
                    color: 'yellow', 
                    label: 'é»ƒç‡ˆ', 
                    desc: 'å¾…åŠ å¼·',        // ä¸»æ¨™é¡Œ
                    sub: '(éœ€ç”³è«‹è£œæ•‘)',   // æ‹¬è™Ÿæ–‡å­—ç§»åˆ°é€™è£¡ï¼Œå°‡æœƒæ›è¡Œé¡¯ç¤º
                    bg: 'bg-yellow-500' 
                };
            };

            // ç•«é¢è¼‰å…¥æ™‚å–å¾—çµ±è¨ˆ
            useEffect(() => {
                if (API_URL === "YOUR_GOOGLE_SCRIPT_URL") return;
                fetch(`${API_URL}?type=stats`)
                    .then(res => res.json())
                    .then(data => {
                        const total = data.green + data.yellow + data.red;
                        setStats({ ...data, total });
                    })
                    .catch(err => console.error("ç„¡æ³•å–å¾—çµ±è¨ˆè³‡æ–™", err));
            }, []);

            const handleSearch = () => {
                if (!query.trim()) return;
                setLoading(true);
                setSearchResult(null);

                fetch(`${API_URL}?q=${encodeURIComponent(query.trim())}`)
                    .then(res => res.json())
                    .then(data => {
                        if (data.status === 'success') {
                            setSearchResult(data.data);
                        } else {
                            setSearchResult('none');
                        }
                    })
                    .catch(err => {
                        alert("æŸ¥è©¢ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦");
                        console.error(err);
                    })
                    .finally(() => {
                        setLoading(false);
                    });
            };

            return (
                <div className="min-h-screen p-4 md:p-8 flex flex-col items-center">
                    <div className="max-w-4xl w-full">
                        <header className="text-center mb-10">
                            <h1 className="text-4xl font-bold text-slate-800 mb-3 tracking-tight">11402 çµ±è¨ˆå­¸(äºŒ)å­¸æœŸæˆç¸¾æŸ¥è©¢</h1>
                            <div className="inline-block bg-slate-800 text-white px-5 py-1.5 rounded-full text-sm font-medium shadow-md mb-2">
                                ä»»èª²è€å¸«ï¼šç‹å»ºæ™º æ•™æˆ
                            </div>
                            <p className="text-slate-500 text-sm mt-4">è«‹è¼¸å…¥å­¸è™Ÿ (å¤§å¯«Ué–‹é ­) æˆ–å§“åæŸ¥è©¢å€‹äººç‹€æ…‹ç‡ˆè™Ÿ</p>
                        </header>

                        {/* çµ±è¨ˆåœ–è¡¨ (åƒ…ç•¶æœ‰è³‡æ–™æ™‚é¡¯ç¤º) */}
                        {stats.total > 0 && (
                            <div className="bg-white p-6 rounded-3xl shadow-sm border border-slate-100 mb-10">
                                <h2 className="text-sm font-bold text-slate-400 uppercase tracking-widest mb-4 flex justify-between">
                                    <span>ç­ç´šç‡ˆè™Ÿåˆ†ä½ˆæ¦‚æ³ (å…± {stats.total} äºº)</span>
                                </h2>
                                <div className="flex h-5 w-full rounded-full overflow-hidden bg-slate-100 mb-6 border border-slate-50">
                                    <div style={{ width: `${(stats.green / stats.total) * 100}%` }} className="bg-green-500"></div>
                                    <div style={{ width: `${(stats.yellow / stats.total) * 100}%` }} className="bg-yellow-500"></div>
                                    <div style={{ width: `${(stats.red / stats.total) * 100}%` }} className="bg-red-500"></div>
                                </div>
                                <div className="grid grid-cols-3 gap-4 text-center">
                                    <div className="p-2"><div className="text-2xl font-black text-green-500">{stats.green}</div><div className="text-xs text-slate-500 font-bold">åŠæ ¼</div></div>
                                    <div className="p-2 border-x border-slate-100"><div className="text-2xl font-black text-yellow-500">{stats.yellow}</div><div className="text-xs text-slate-500 font-bold">å¾…è£œæ•‘</div></div>
                                    <div className="p-2"><div className="text-2xl font-black text-red-500">{stats.red}</div><div className="text-xs text-slate-500 font-bold">ä¸åŠæ ¼</div></div>
                                </div>
                            </div>
                        )}

                        {/* æœå°‹æ¡† */}
                        <div className="flex flex-col items-center gap-6 mb-12">
                            <div className="flex w-full max-w-md shadow-2xl rounded-2xl overflow-hidden border-2 border-white focus-within:ring-4 focus-within:ring-blue-100 transition-all">
                                <input
                                    type="text"
                                    placeholder="è¼¸å…¥å­¸è™Ÿ æˆ– å§“å..."
                                    className="flex-grow px-6 py-4 outline-none text-lg"
                                    value={query}
                                    onChange={(e) => setQuery(e.target.value)}
                                    onKeyPress={(e) => e.key === 'Enter' && handleSearch()}
                                    disabled={loading}
                                />
                                <button 
                                    onClick={handleSearch}
                                    disabled={loading}
                                    className={`bg-blue-600 text-white px-8 py-4 font-bold transition-colors ${loading ? 'opacity-50 cursor-not-allowed' : 'hover:bg-blue-700 active:scale-95'}`}
                                >
                                    {loading ? '...' : 'æŸ¥è©¢'}
                                </button>
                            </div>
                        </div>

                        {/* çµæœé¡¯ç¤ºå€ */}
                        <div className="min-h-[400px] flex items-center justify-center">
                            {searchResult === 'none' && !loading && (
                                <div className="text-center animate-bounce text-slate-400">
                                    <div className="text-5xl mb-4">ğŸ”</div>
                                    <p className="text-lg font-bold">æ‰¾ä¸åˆ°è³‡æ–™ï¼Œè«‹ç¢ºèªè¼¸å…¥æ˜¯å¦æ­£ç¢º</p>
                                </div>
                            )}

                            {searchResult && searchResult !== 'none' && !loading && (() => {
                                const status = getStatus(searchResult.score);
                                return (
                                    <div className="bg-white w-full max-w-md rounded-[40px] shadow-2xl overflow-hidden border border-slate-100 flex flex-col md:flex-row animate-in fade-in zoom-in duration-300">
                                        <div className="bg-slate-900 p-8 flex flex-col gap-6 items-center justify-center">
                                            {/* ç‡ˆè™Ÿå‹•ç•«å€ */}
                                            <div className={`relative w-16 h-16 rounded-full border-4 border-slate-800 flex items-center justify-center transition-all duration-700 ${status.color === 'red' ? 'bg-red-500 shadow-[0_0_35px_rgba(239,68,68,1)]' : 'bg-slate-800 opacity-10'}`}>
                                                {status.color === 'red' && <div className="w-16 h-16 rounded-full bg-red-500 animate-blink absolute"></div>} 
                                            </div>
                                            <div className={`relative w-16 h-16 rounded-full border-4 border-slate-800 flex items-center justify-center transition-all duration-700 ${status.color === 'yellow' ? 'bg-yellow-500 shadow-[0_0_35px_rgba(234,179,8,1)]' : 'bg-slate-800 opacity-10'}`}>
                                                {status.color === 'yellow' && <div className="w-16 h-16 rounded-full bg-yellow-500 animate-blink absolute"></div>}
                                            </div>
                                            <div className={`relative w-16 h-16 rounded-full border-4 border-slate-800 flex items-center justify-center transition-all duration-700 ${status.color === 'green' ? 'bg-green-500 shadow-[0_0_35px_rgba(34,197,94,1)]' : 'bg-slate-800 opacity-10'}`}>
                                                {status.color === 'green' && <div className="w-16 h-16 rounded-full bg-green-500 animate-blink absolute"></div>}
                                            </div>
                                        </div>

                                        <div className="p-10 flex-grow flex flex-col justify-center bg-white text-center md:text-left">
                                            <span className="text-blue-500 text-xs font-black uppercase tracking-widest mb-2">Individual Report</span>
                                            <h3 className="text-4xl font-black text-slate-800 mb-1">{searchResult.name}</h3>
                                            <p className="text-slate-400 font-mono text-sm mb-8 tracking-tighter italic">{searchResult.id}</p>
                                            
                                            <div className="border-t border-slate-100 pt-8">
                                                <p className="text-xs text-slate-400 font-bold mb-2 uppercase">Study Progress</p>
                                                
                                                {/* --- ä¿®æ”¹è™•ï¼šæ–‡å­—é¡¯ç¤ºå€å¡Š --- */}
                                                <div className={`mb-6 ${
                                                    status.color === 'red' ? 'text-red-500' :
                                                    status.color === 'green' ? 'text-green-500' : 'text-yellow-600'
                                                }`}>
                                                    {/* ä¸»æ¨™é¡Œ (å¤§å­—) */}
                                                    <div className="text-4xl font-black leading-tight">
                                                        {status.desc}
                                                    </div>
                                                    
                                                    {/* å‰¯æ¨™é¡Œ (å¦‚æœæœ‰æ‹¬è™Ÿæ–‡å­—ï¼Œå‰‡æ›è¡Œé¡¯ç¤ºä¸¦ç¸®å°å­—é«”) */}
                                                    {status.sub && (
                                                        <div className="text-xl font-bold mt-1 opacity-80">
                                                            {status.sub}
                                                        </div>
                                                    )}
                                                </div>
                                                {/* ------------------------- */}
                                                
                                                <div className="mt-4 p-4 bg-slate-50 rounded-2xl border border-slate-100">
                                                    <p className="text-xs text-slate-500 leading-relaxed font-medium">
                                                        {status.color === 'yellow' ? (
                                                            "æ‚¨çš„å­¸ç¿’ç‹€æ…‹ç›®å‰ç‚ºé»ƒç‡ˆã€‚è«‹ç¢ºèªæ˜¯å¦éœ€è¦åƒåŠ è£œæ•‘æ•™å­¸ï¼Œä¸¦ä¸»å‹•è¯ç¹«æ•™æˆè¨è«–ã€‚"
                                                        ) : status.color === 'red' ? (
                                                            "æ‚¨çš„å­¸ç¿’ç‹€æ…‹ç›®å‰ç‚ºç´…ç‡ˆã€‚æœ¬å­¸æœŸæˆç¸¾æœªé”æ¨™æº–ï¼Œè«‹ç•™æ„å¾ŒçºŒç›¸é—œé‡ä¿®è¦å®šã€‚"
                                                        ) : (
                                                            "æ­å–œï¼æ‚¨çš„å­¸ç¿’ç‹€æ…‹ç‚ºç¶ ç‡ˆã€‚æœ¬å­¸æœŸæˆç¸¾è¡¨ç¾å„ªç•°ï¼Œè«‹ç¹¼çºŒä¿æŒï¼"
                                                        )}
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                );
                            })()}
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>